\ProvidesPackage{hocr}
\RequirePackage{etoolbox}
\RequirePackage[UTF8]{inputenc}
\RequirePackage{tgschola}
%User functions
%\DeclareListParser{\hocrattrparse}{;}
\gdef\ParseAttributes{%
  %\renewcommand*\do[1]{#1::}%\hocr@attrs#1}
\expandafter\hocr@attrs\attribs;\@empty
}
\gdef\UseAttribute#1{%
  \ifcsdef{attrdrv@#1}{\csuse{attrdrv@#1}}{Neni}%
}

\long\gdef\DeclareClassActions#1#2#3{%
%#1 jméno třídy, #2 akce při otevíracím tagu, #3 akce u zavíracího tagu
\csgdef{clsst@#1}{#2}
 \csgdef{clsend@#1}{#3}
}
\gdef\ClassStartActions#1{%
\let\hocr@classaction=\hocr@classstart%
\expandafter\hocr@classproc\expandafter{#1}%
}
\gdef\ClassEndActions#1{%
\let\hocr@classaction=\hocr@classend%
\expandafter\hocr@classproc\expandafter{#1}%
}
%Definice pomocných funkcí
\gdef\hocr@classaction#1{}
\gdef\hocr@classstart#1{%
\let\oldunderscore=\textunderscore%
\def\textunderscore{_}%
\ifcsdef{clsst@#1}{\csuse{clsst@#1}}{}%
\let\textunderscore=\oldunderscore%
}
\gdef\hocr@classend#1{%
\let\oldunderscore=\textunderscore%
\def\textunderscore{_}%
\ifcsdef{clsend@#1}{\csuse{clsend@#1}}{}%
\let\textunderscore=\oldunderscore%
}
\gdef\hocr@classproc#1{% 
\hocr@classelement#1 \@empty%
}
\gdef\hocr@classelement#1 #2{%
\hocr@classaction{#1}% fbox here to have a visual test
\ifx #2\@empty\else%
\expandafter\hocr@classelement%
\fi%
#2%
}
\gdef\hocr@attrs#1 #2;#3{%
  \hocr@defattr{#1}{#2}%
  \ifx #3\@empty\else%
  \expandafter\hocr@attrs%
  \fi
  #3%
}
\gdef\hocr@defattr#1#2{%
\setbox0=\hbox{\if #1{bbox} \hocr@blbox#2\@empty\fi}
\csgdef{attrdrv@#1}{#2}%
}

\gdef\hocr@blbox#1 #2 #3\@empty{%
\gdef\textposbbox{\the\numexpr #1/5\relax pt}
\gdef\textposbboy{\the\numexpr #2/5\relax pt}
}
\endinput